[tox]
envlist = py{310,311,312,313}-{test,devdeps}-{all,qt,jupyter}, py311-glue{118,119,120,121,122}-all, py311-all-plotly{5,6}, py312-test-3d-{qt,jupyter}
requires = pip >= 18.0
           setuptools >= 30.3.0

[testenv]
passenv =
    DISPLAY
    HOME
changedir =
    test: .tmp/{envname}
extras =
    test: test
    qt: qt
    jupyter: jupyter
    3d: 3d
    all: test
    all: qt
    all: jupyter
    all: 3d
commands =
    glue118: pip install glue-core==1.18.* glue-jupyter<=0.20.1
    glue119: pip install glue-core==1.19.* glue-jupyter<=0.20.1
    glue120: pip install glue-core==1.20.* glue-jupyter<=0.20.1
    glue121: pip install glue-core==1.21.*
    glue122: pip install glue-core==1.22.*
    plotly5: pip install plotly~=5.24
    plotly6: pip install plotly>=6
    test: pip freeze
    test: pytest --pyargs glue_plotly --cov glue_plotly {posargs}
deps =
    devdeps: git+https://github.com/glue-viz/glue
    devdeps: git+https://github.com/glue-viz/glue-qt
    devdeps: git+https://github.com/glue-viz/glue-jupyter
    devdeps: git+https://github.com/glue-viz/glue-vispy-viewers
    devdeps: git+https://github.com/plotly/plotly.py
    devdeps: pyqt6

[testenv:codestyle]
skipsdist = true
skip_install = true
description = Run all style and file checks with pre-commit
deps =
    pre-commit
commands =
    pre-commit install-hooks
    pre-commit run --color always --all-files --show-diff-on-failure
